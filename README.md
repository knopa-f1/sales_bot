# Telegram Shop Bot

Телеграм-бот-магазин, выполненный на базе aiogram 3, с поддержкой корзины, заказов, оплат и FAQ.
Бот работает совместно с Django-админкой через одну общую базу данных PostgreSQL.

---

## Основной функционал

- `/start` — приветствие и проверка подписки на канал/группу
- Каталог товаров: категории → подкатегории → товары
- Просмотр товаров с фото и описанием
- Добавление/удаление из корзины
- Оформление заказа
- Оплата через Telegram Pay (ЮKassa)
- FAQ с inline-режимом
- Все заказы сохраняются в Excel
- Рассылки по пользователям (через админку)
- Асинхронное взаимодействие с БД

---

## Переменные окружения (`.env`)

Необходимо создать `.env` файл на основе `.env.example`. Пример:

```env
TG_BOT_TOKEN=1234567890
PAYMENT_PROVIDER_TOKEN=your_provider_token_from_botfather
IMAGE_PATH=/media/              # путь к изображениям из volume
ENV_TYPE=prod

DB_DSN=postgresql+asyncpg://admin_user:admin_password@db:5432/admin_db

REPORT_PATH=/media/orders.xlsx

REQUIRED_CHANNEL_ID=-1001234567890     # ID Telegram-группы или канала
```

## Запуск через Docker

```bash
# Сеть backend должна быть создана:
docker network create backend

# Запуск контейнеров
# Контейнер автоматически подключается к БД, доступной через сеть backend.
docker-compose up -d --build
```

## Тесты

Для запуска тестов:

```bash
pytest
```

## Замечания

Все заказы сохраняются в Excel-файл (REPORT_PATH)

Логирование ведётся в папку logs/

Бот использует apscheduler для рассылок по заданиям из админки: чтобы сообщение было отправлено, администратор должен
создать запись в разделе «Рассылки» и выбрать получателей;
бот автоматически обработает отложенные записи со статусом pending и отправит сообщения выбранным пользователям.

